import jdk.javadoc.doclet.DocletEnvironment;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.List;
import java.util.Scanner;

public class Main {

    private static final int PORT = 1234;
    private static boolean end_client = false;
    private static boolean testing_attack = false;


    public static void main(String[] args) throws InterruptedException {
        System.out.println("1. Join a Game");
        System.out.println("2. Host a Game");
        System.out.print("Choose an option: ");

        try (Scanner scanner = new Scanner(System.in)) {
            int option = scanner.nextInt();

            if (option == 1) {
                scanner.nextLine();
                System.out.print("Enter your name: ");
                String playerName = scanner.nextLine();
                System.out.print("Enter the other player's IP address: ");
                String otherPlayerIP = scanner.nextLine();
                connectToOtherPlayer(playerName, otherPlayerIP);
            } else if (option == 2) {
                scanner.nextLine();
                System.out.print("Enter your name: ");
                String playerName = scanner.nextLine();
                startServer(playerName);
            } else {
                System.out.println("Invalid option. Exiting.");
            }
        }
    }

    public static void Testing_attack() {
        System.out.println("ok ça marche.");
    }

    private static boolean confirm_buy(DefenseManager defman, DefensiveSoftware dfs){
        System.out.println("Budget restant : " + defman.budget);
        System.out.println("Prix : " + dfs.getPrice());
        System.out.println(dfs.getDescription());
        System.out.println("Etes-vous sur(e) de vouloir acheter "+ DefensiveSoftware.getName() + " ?");

        String reponse = new Scanner(System.in).nextLine();
        if(reponse.equals("oui")){
            return(true);
        } else{
        return false;
        }
    }

    private static void connectToOtherPlayer(String playerName, String otherPlayerIP) {
        try (Socket socket = new Socket(otherPlayerIP, PORT)) {
            System.out.println("Connected to the other player.");

            new Thread(() -> handleIncomingMessages(socket)).start();

            System.out.println("Lancez une attaque parmis les suivantes:");
            System.out.println("[1] - Ransomware\n[2] - Reconnaissance\n[3] - Ddos\n");

            String attaque = new Scanner(System.in).nextLine();
            ExploitFramework ef = new ExploitFramework();

            switch (attaque){

                case "1":

                    break;

                case "2":

                    break;

                case "3":

                    break;

                default:
                    break;

            }




            try (PrintWriter writer = new PrintWriter(socket.getOutputStream(), true)) {
                    writer.println(attaque);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static void startServer(String playerName) throws InterruptedException {
        try (ServerSocket serverSocket = new ServerSocket(PORT)) {
            System.out.println("Waiting for the other player to connect...");
            System.out.println("Your IP address is: " + getLocalIpAddress());

            //Socket socket = serverSocket.accept();
            System.out.println("The other player connected.");
            DefenseManager defman = new DefenseManager();
            boolean done = false;
            while(!done) {

                System.out.println("Installez une défense parmis les suivantes:");
                System.out.println("\u001B[34Antivirus\u001B[0m");
                System.out.println("[1] - Ariva economy\n[2] - AI Protect Pro\n[3] - CyberSecure MegaDefender 9000 Ultra Turbo Extreme Edition \n");

                System.out.println("\u001B[33mFirewall\u001B[0m");
                System.out.println("[4] - Bicrosoft Firewall \n[5] - FenceGuard lite\n[6] - FortressPro Elite Security Suite\n");


                System.out.println("\u001B[35mChiffrement\u001B[0m");
                System.out.println("[7] - SecureLite Encryptor 1\n[8] - CipherGuard 360 Standard Edition\n[9] - QuantumShield Pro Cryptographic Suite, Maximum Edition\n");


                System.out.println("\u001B[35mFurtivité\u001B[0m");
                System.out.println("[10] - SudVPN\n[11] - CipherGuard 360 Standard Edition\n[12] - QuantumCloak Pro Stealth Enhancer Supreme Ultra Mega Cybernetic Guardian\n");

                String software = new Scanner(System.in).nextLine();

                switch (software) {

                    case "1":
                        if (confirm_buy(defman, new AntivirusLevel1())) {
                            defman.installSoftware(new AntivirusLevel1());}
                        break;

                    case "2":
                        if (confirm_buy(defman, new AntivirusLevel2())) {
                            defman.installSoftware(new AntivirusLevel2());}
                        break;

                    case "3":
                        if (confirm_buy(defman, new AntivirusLevel3())) {
                            defman.installSoftware(new AntivirusLevel3());}
                        break;

                    case "4":
                        if (confirm_buy(defman, new AntivirusLevel2())) {
                            defman.installSoftware(new AntivirusLevel2());}
                        break;

                    case "5":
                        if (confirm_buy(defman, new AntivirusLevel2())) {
                            defman.installSoftware(new AntivirusLevel2());}
                        break;

                    case "6":
                        if (confirm_buy(defman, new AntivirusLevel2())) {
                            defman.installSoftware(new AntivirusLevel2());}
                        break;

                    case "13":
                        done = true;
                        break;

                    default:
                        break;

                }

            }

            System.out.println(defman.getInstalledSoftware());
            defman.getScores();
            //new Thread(() -> handleIncomingMessages(socket)).start();
            while(true){
                 String message = new Scanner(System.in).nextLine();

            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static String getLocalIpAddress() {
        try (Socket socket = new Socket("google.com", 80)) {
            return socket.getLocalAddress().getHostAddress();
        } catch (IOException e) {
            e.printStackTrace();
            return "N/A";
        }
    }

    private static void handleIncomingMessages(Socket socket) {
        try (BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream()))) {
            String line;
            while ((line = reader.readLine()) != null) {
                if(line.equals("test_attack")) {
                    Testing_attack();
                }
            }
        } catch (IOException ignored) {}
        finally {
            try {
                socket.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
